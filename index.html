<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gender and Economic Development Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .header-logos {
            position: absolute;
            top: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logos.left {
            left: 30px;
        }

        .header-logos.right {
            right: 30px;
        }

        .header-logos img {
            height: 60px;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            padding: 0 40px;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            color: #666;
        }

        .tab:hover {
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
        }

        .tab.active {
            color: #4facfe;
            border-bottom-color: #4facfe;
            background: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Analysis Tab Styles */
        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #4facfe;
            border-bottom: 2px solid #4facfe;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #333;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .stats {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #1976d2;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .badge.warning {
            background: #ff9800;
        }

        /* Policy Projection Styles */
        .policy-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .controls-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .control-icon {
            font-size: 1.3em;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
        }

        .slider-value {
            min-width: 60px;
            text-align: right;
            font-weight: bold;
            color: #4facfe;
        }

        .results-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .result-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 2em;
            font-weight: bold;
            color: #1976d2;
        }

        .impact-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 10px;
        }

        .impact-positive {
            background: #d4edda;
            color: #155724;
        }

        .impact-neutral {
            background: #fff3cd;
            color: #856404;
        }

        .impact-negative {
            background: #f8d7da;
            color: #721c24;
        }

        .country-selector {
            margin-bottom: 30px;
        }

        .country-selector select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .country-selector select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .subindicator-select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9em;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .subindicator-select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .country-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .country-info-card h4 {
            margin: 0 0 15px 0;
            font-size: 1.4em;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }

        .country-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .country-stat {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 6px;
        }

        .country-stat-label {
            font-size: 0.8em;
            opacity: 0.9;
            margin-bottom: 3px;
        }

        .country-stat-value {
            font-size: 1.1em;
            font-weight: bold;
        }

        .footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logos left">
                <img src="genero.png" alt="Gender" title="Gender Equality">
                <img src="pobreza.png" alt="Development" title="Economic Development">
            </div>
            <div class="header-logos right">
                <img src="banco.png" alt="World Bank" title="World Bank Data">
            </div>
            <h1>🌍 Gender and Economic Development Analysis</h1>
            <p>Comprehensive analysis and policy projection models for development</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">
                📊 Gender and Economic Development Analysis
            </div>
            <div class="tab" onclick="switchTab(1)">
                🎯 Gender and Development Policy Projection Models
            </div>
            <div class="tab" onclick="switchTab(2)">
                ⚙️ Regional Configuration
            </div>
        </div>

        <!-- Tab 1: Analysis Results -->
        <div class="tab-content active" id="tab-0">
            <div class="section">
                <h2>📊 Analysis Summary</h2>
                <div class="stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">63</div>
                            <div class="stat-label">Countries Analyzed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">129</div>
                            <div class="stat-label">Variables</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Models with R² ≥ 0.75</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">2</div>
                            <div class="stat-label">Optimal Clusters</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>📈 Interactive Dashboards</h2>
                <div class="grid">
                    <div class="card">
                        <h3>🔍 Descriptive Analysis</h3>
                        <p>Explore basic statistics, distributions, and data quality metrics for all variables.</p>
                        <a href="resultados/dashboards/descriptive_dashboard.html" class="btn" target="_blank">View Dashboard</a>
                    </div>

                    <div class="card">
                        <h3>🔗 Correlation Matrix</h3>
                        <p>Interactive heatmap showing correlations between top variables and GDP growth.</p>
                        <a href="resultados/dashboards/correlation_matrix.html" class="btn" target="_blank">View Matrix</a>
                        <span class="badge">NEW</span>
                    </div>

                    <div class="card">
                        <h3>📊 Top Correlations</h3>
                        <p>Bar chart displaying the strongest correlations with economic development.</p>
                        <a href="resultados/dashboards/top_correlations.html" class="btn" target="_blank">View Correlations</a>
                    </div>

                    <div class="card">
                        <h3>📈 Correlation Comparison</h3>
                        <p>Compare Pearson vs Spearman correlation coefficients.</p>
                        <a href="resultados/dashboards/pearson_vs_spearman.html" class="btn" target="_blank">View Comparison</a>
                    </div>

                    <div class="card">
                        <h3>🎯 Country Clusters</h3>
                        <p>Visualize country groupings based on gender and development indicators.</p>
                        <a href="resultados/dashboards/clusters_pca.html" class="btn" target="_blank">View Clusters</a>
                    </div>

                    <div class="card">
                        <h3>📉 Cluster Selection</h3>
                        <p>Analysis of optimal number of clusters using silhouette method.</p>
                        <a href="resultados/dashboards/elbow_method.html" class="btn" target="_blank">View Analysis</a>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>🤖 Machine Learning Results</h2>
                <div class="grid">
                    <div class="card">
                        <h3>⚡ Enhanced ML Comparison</h3>
                        <p>Compare performance of advanced ML models with parameter optimization.</p>
                        <a href="resultados/dashboards/enhanced_ml_comparison.html" class="btn" target="_blank">View Comparison</a>
                        <span class="badge">ENHANCED</span>
                    </div>

                    <div class="card">
                        <h3>🎯 Variable Importance</h3>
                        <p>Identify which variables are most important for predicting economic growth.</p>
                        <a href="resultados/dashboards/variable_importance.html" class="btn" target="_blank">View Importance</a>
                    </div>

                    <div class="card">
                        <h3>📊 Predictions vs Reality</h3>
                        <p>Evaluate model accuracy by comparing predictions with actual values.</p>
                        <a href="resultados/dashboards/predictions_vs_real.html" class="btn" target="_blank">View Predictions</a>
                    </div>

                    <div class="card">
                        <h3>📋 Model Performance</h3>
                        <div style="margin-top: 15px;">
                            <p><strong>Random Forest:</strong> R² = 0.750 <span class="badge">✓</span></p>
                            <p><strong>Gradient Boosting:</strong> R² = 0.737 <span class="badge warning">⚠</span></p>
                            <p><strong>Neural Network:</strong> R² = 0.404 <span class="badge warning">⚠</span></p>
                            <p><strong>Support Vector Machine:</strong> R² = 0.650 <span class="badge warning">⚠</span></p>
                            <p><strong>XGBoost:</strong> R² = 0.684 <span class="badge warning">⚠</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>🎯 Final Optimized Models</h2>
                <div class="grid">
                    <div class="card">
                        <h3>🏆 Complete Model Dashboard</h3>
                        <p>Comprehensive dashboard showing all optimized models with smart parameter tuning results.</p>
                        <a href="resultados/modelos_finales/final_models_dashboard.html" class="btn" target="_blank">View Dashboard</a>
                        <span class="badge">OPTIMIZED</span>
                    </div>

                    <div class="card">
                        <h3>📊 Model Performance</h3>
                        <p>Interactive comparison of final optimized model performance and target achievement.</p>
                        <a href="resultados/modelos_finales/final_model_comparison.html" class="btn" target="_blank">View Performance</a>
                    </div>

                    <div class="card">
                        <h3>🔧 Optimization Journey</h3>
                        <p>Track how each parameter was optimized and which changes improved performance.</p>
                        <a href="resultados/modelos_finales/optimization_journey.html" class="btn" target="_blank">View Journey</a>
                    </div>

                    <div class="card">
                        <h3>🎯 Predictions Analysis</h3>
                        <p>Scatter plot analysis of model predictions vs actual values for all optimized models.</p>
                        <a href="resultados/modelos_finales/predictions_vs_reality.html" class="btn" target="_blank">View Analysis</a>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>📄 Data Reports</h2>
                <div class="grid">
                    <div class="card">
                        <h3>📊 Descriptive Statistics</h3>
                        <p>Complete statistical summary of all variables (CSV format).</p>
                        <a href="resultados/reportes/descriptive_statistics.csv" class="btn" target="_blank">Download CSV</a>
                    </div>

                    <div class="card">
                        <h3>🔗 Correlation Table</h3>
                        <p>Complete correlation analysis results for all variables.</p>
                        <a href="resultados/reportes/correlation_table.csv" class="btn" target="_blank">Download CSV</a>
                    </div>

                    <div class="card">
                        <h3>🎯 Cluster Profiles</h3>
                        <p>Detailed profiles and characteristics of each country cluster.</p>
                        <a href="resultados/reportes/cluster_profiles.csv" class="btn" target="_blank">Download CSV</a>
                    </div>

                    <div class="card">
                        <h3>📋 Executive Summary</h3>
                        <p>Comprehensive summary of all analysis results and findings.</p>
                        <a href="resultados/reportes/executive_summary.txt" class="btn" target="_blank">View Summary</a>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>🔍 Key Findings</h2>
                <div class="stats">
                    <p><strong>🏆 Strongest Correlation:</strong> E_School enrollment, primary, female (% gross) (r = -0.489)</p>
                    <p><strong>🤖 Best ML Model:</strong> Random Forest achieved R² = 0.750</p>
                    <p><strong>🎯 Country Grouping:</strong> 2 distinct clusters identified based on development patterns</p>
                    <p><strong>📊 Dataset Coverage:</strong> Analysis covers 63 countries with comprehensive gender and development metrics</p>
                </div>
            </div>
        </div>

        <!-- Tab 2: Policy Projection Models -->
        <div class="tab-content" id="tab-1">
            <div class="section">
                <h2>🎯 Gender and Development Policy Projection Models</h2>
                <p style="color: #666; margin-bottom: 30px;">
                    Adjust the significant variables from our model to see their projected impact on GDP growth.
                    Select a country to start with its current values, or use custom settings.
                </p>

                <div class="country-selector">
                    <label for="country-select" style="font-weight: 600; margin-bottom: 10px; display: block;">Select Country:</label>
                    <select id="country-select" onchange="loadCountryData()">
                        <option value="">-- Custom Values --</option>
                        <option value="Afghanistan">Afghanistan</option>
                        <option value="Angola">Angola</option>
                        <option value="Bangladesh">Bangladesh</option>
                        <option value="Benin">Benin</option>
                        <option value="Bhutan">Bhutan</option>
                        <option value="Bolivia">Bolivia</option>
                        <option value="Burkina Faso">Burkina Faso</option>
                        <option value="Burundi">Burundi</option>
                        <option value="Cambodia">Cambodia</option>
                        <option value="Cameroon">Cameroon</option>
                        <option value="Central African Republic">Central African Republic</option>
                        <option value="Chad">Chad</option>
                        <option value="Comoros">Comoros</option>
                        <option value="Congo, Dem. Rep.">Congo, Dem. Rep.</option>
                        <option value="Congo, Rep.">Congo, Rep.</option>
                        <option value="Egypt, Arab Rep.">Egypt, Arab Rep.</option>
                        <option value="Eritrea">Eritrea</option>
                        <option value="Eswatini">Eswatini</option>
                        <option value="Ethiopia">Ethiopia</option>
                        <option value="Gambia, The">Gambia, The</option>
                        <option value="Ghana">Ghana</option>
                        <option value="Guinea">Guinea</option>
                        <option value="Guinea-Bissau">Guinea-Bissau</option>
                        <option value="Honduras">Honduras</option>
                        <option value="India">India</option>
                        <option value="Jordan">Jordan</option>
                        <option value="Kenya">Kenya</option>
                        <option value="Kyrgyz Republic">Kyrgyz Republic</option>
                        <option value="Lao PDR">Lao PDR</option>
                        <option value="Lesotho">Lesotho</option>
                        <option value="Liberia">Liberia</option>
                        <option value="Madagascar">Madagascar</option>
                        <option value="Malawi">Malawi</option>
                        <option value="Mali">Mali</option>
                        <option value="Mauritania">Mauritania</option>
                        <option value="Morocco">Morocco</option>
                        <option value="Mozambique">Mozambique</option>
                        <option value="Myanmar">Myanmar</option>
                        <option value="Nepal">Nepal</option>
                        <option value="Nicaragua">Nicaragua</option>
                        <option value="Niger">Niger</option>
                        <option value="Nigeria">Nigeria</option>
                        <option value="Pakistan">Pakistan</option>
                        <option value="Papua New Guinea">Papua New Guinea</option>
                        <option value="Philippines">Philippines</option>
                        <option value="Rwanda">Rwanda</option>
                        <option value="Samoa">Samoa</option>
                        <option value="Senegal">Senegal</option>
                        <option value="Sierra Leone">Sierra Leone</option>
                        <option value="Sri Lanka">Sri Lanka</option>
                        <option value="Sudan">Sudan</option>
                        <option value="Syrian Arab Republic">Syrian Arab Republic</option>
                        <option value="Tajikistan">Tajikistan</option>
                        <option value="Tanzania">Tanzania</option>
                        <option value="Timor-Leste">Timor-Leste</option>
                        <option value="Togo">Togo</option>
                        <option value="Tunisia">Tunisia</option>
                        <option value="Uganda">Uganda</option>
                        <option value="Uzbekistan">Uzbekistan</option>
                        <option value="Vanuatu">Vanuatu</option>
                        <option value="Yemen, Rep.">Yemen, Rep.</option>
                        <option value="Zambia">Zambia</option>
                        <option value="Zimbabwe">Zimbabwe</option>
                    </select>
                </div>

                <div class="policy-content">
                    <div class="controls-panel">
                        <div id="country-info-card" class="country-info-card" style="display: none;">
                            <h4 id="country-name">Country Information</h4>
                            <div class="country-stats">
                                <div class="country-stat">
                                    <div class="country-stat-label">GDP Growth Trend</div>
                                    <div class="country-stat-value" id="country-gdp">--</div>
                                </div>
                                <div class="country-stat">
                                    <div class="country-stat-label">Primary Enrollment</div>
                                    <div class="country-stat-value" id="country-enrollment">--</div>
                                </div>
                                <div class="country-stat">
                                    <div class="country-stat-label">Fertility Rate</div>
                                    <div class="country-stat-value" id="country-fertility">--</div>
                                </div>
                                <div class="country-stat">
                                    <div class="country-stat-label">Life Expectancy (F)</div>
                                    <div class="country-stat-value" id="country-life">--</div>
                                </div>
                            </div>
                        </div>

                        <h3 style="margin-bottom: 20px; color: #4facfe;">Adjust Policy Variables</h3>

                        <div class="control-group">
                            <div class="control-label">
                                <span class="control-icon">📚</span>
                                <span>Primary School Enrollment, Female (% gross)</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <select id="school-subindicator" class="subindicator-select" onchange="updateSubIndicator('school')">
                                    <option value="primary-gross">Primary, female (% gross) - r=-0.489</option>
                                    <option value="primary-net">Primary, female (% net) - r=-0.316</option>
                                    <option value="primary-gpi">Primary (GPI) - r=-0.350</option>
                                    <option value="adjusted-net">Adjusted net enrollment - r=-0.272</option>
                                    <option value="primary-completion">Primary completion rate - r=-0.237</option>
                                </select>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="30" max="130" value="85" step="1" class="slider" id="school-enrollment">
                                <span class="slider-value"><span id="school-val">85</span>%</span>
                            </div>
                            <small style="color: #666; margin-top: 5px; display: block;">Higher enrollment typically correlates with economic growth</small>
                        </div>

                        <div class="control-group">
                            <div class="control-label">
                                <span class="control-icon">⚕️</span>
                                <span>Communicable Diseases Death Rate (%)</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <select id="disease-subindicator" class="subindicator-select" onchange="updateSubIndicator('disease')">
                                    <option value="ages-15-59">Ages 15-59, female - r=+0.470</option>
                                    <option value="ages-60plus">Ages 60+, female - r=+0.445</option>
                                    <option value="all-female">All ages, female - r=+0.306</option>
                                    <option value="ages-5-14">Ages 5-14, female - r=+0.223</option>
                                    <option value="total-population">Total population - r=+0.241</option>
                                </select>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="10" max="80" value="45" step="1" class="slider" id="disease-rate">
                                <span class="slider-value"><span id="disease-val">45</span>%</span>
                            </div>
                            <small style="color: #666; margin-top: 5px; display: block;">Lower rates indicate better health systems</small>
                        </div>

                        <div class="control-group">
                            <div class="control-label">
                                <span class="control-icon">🤕</span>
                                <span>Death by Injury, Female (%)</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <select id="injury-subindicator" class="subindicator-select" onchange="updateSubIndicator('injury')">
                                    <option value="ages-15-59">Ages 15-59, female - r=-0.460</option>
                                    <option value="all-ages">All ages, female - r=-0.385</option>
                                    <option value="ages-5-14">Ages 5-14, female - r=-0.351</option>
                                    <option value="ages-0-4">Ages 0-4, female - r=-0.241</option>
                                </select>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="1" max="20" value="8" step="0.5" class="slider" id="injury-rate">
                                <span class="slider-value"><span id="injury-val">8</span>%</span>
                            </div>
                            <small style="color: #666; margin-top: 5px; display: block;">Safety indicator for women</small>
                        </div>

                        <div class="control-group">
                            <div class="control-label">
                                <span class="control-icon">👶</span>
                                <span>Fertility Rate (births per woman)</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <select id="fertility-subindicator" class="subindicator-select" onchange="updateSubIndicator('fertility')">
                                    <option value="total">Total fertility rate - r=-0.418</option>
                                    <option value="under5-mortality">Under-5 mortality (related) - r=+0.262</option>
                                    <option value="maternal-mortality">Maternal mortality ratio - r=+0.230</option>
                                    <option value="maternal-death-risk">Lifetime maternal death risk - r=+0.323</option>
                                </select>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="1" max="7" value="3.5" step="0.1" class="slider" id="fertility-rate">
                                <span class="slider-value"><span id="fertility-val">3.5</span></span>
                            </div>
                            <small style="color: #666; margin-top: 5px; display: block;">Lower rates often associated with development</small>
                        </div>

                        <div class="control-group">
                            <div class="control-label">
                                <span class="control-icon">⚖️</span>
                                <span>Female Obesity Prevalence (%)</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <select id="obesity-subindicator" class="subindicator-select" onchange="updateSubIndicator('obesity')">
                                    <option value="obesity-adult">Obesity, ages 18+ - r=+0.414</option>
                                    <option value="overweight-adult">Overweight, adult female - r=+0.199</option>
                                    <option value="overweight-under5">Overweight, under 5 - r=+0.239</option>
                                </select>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="1" max="40" value="12" step="0.5" class="slider" id="obesity-rate">
                                <span class="slider-value"><span id="obesity-val">12</span>%</span>
                            </div>
                            <small style="color: #666; margin-top: 5px; display: block;">Nutrition and lifestyle indicator</small>
                        </div>

                        <div class="control-group">
                            <div class="control-label">
                                <span class="control-icon">📖</span>
                                <span>Youth Literacy Gender Parity Index</span>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <select id="literacy-subindicator" class="subindicator-select" onchange="updateSubIndicator('literacy')">
                                    <option value="youth-gpi">Youth (15-24) GPI - r=-0.383</option>
                                    <option value="youth-female-rate">Youth female literacy rate - r=-0.251</option>
                                    <option value="youth-illiterate">Youth illiterate, % female - r=-0.254</option>
                                    <option value="secondary-gpi">Secondary enrollment GPI - r=-0.279</option>
                                    <option value="secondary-female">Secondary pupils, % female - r=-0.290</option>
                                </select>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="0.5" max="1.2" value="0.95" step="0.01" class="slider" id="literacy-parity">
                                <span class="slider-value"><span id="literacy-val">0.95</span></span>
                            </div>
                            <small style="color: #666; margin-top: 5px; display: block;">1.0 = perfect gender equality in literacy</small>
                        </div>

                        <button class="btn" onclick="resetValues()" style="margin-top: 20px; width: 100%;">
                            Reset to Default Values
                        </button>
                    </div>

                    <div class="results-panel">
                        <h3 style="margin-bottom: 20px; color: #4facfe;">Projected Impact</h3>

                        <div class="result-card">
                            <div class="result-label">Projected GDP Per Capita Growth</div>
                            <div class="result-value" id="gdp-projection">+2.5%</div>
                            <span class="impact-indicator impact-positive" id="impact-label">Positive Impact</span>
                        </div>

                        <div class="result-card">
                            <div class="result-label">Model Confidence</div>
                            <div class="result-value" style="font-size: 1.5em;" id="confidence">75%</div>
                            <small style="color: #666; display: block; margin-top: 10px;">
                                Based on Random Forest model (R² = 0.750)
                            </small>
                        </div>

                        <div class="result-card">
                            <h4 style="margin-bottom: 15px; color: #333;">Policy Recommendations</h4>
                            <div id="recommendations" style="line-height: 1.8;">
                                <p style="color: #666;">Adjust the variables to see specific policy recommendations based on your projections.</p>
                            </div>
                        </div>

                        <div class="result-card">
                            <h4 style="margin-bottom: 15px; color: #333;">Variable Impact Summary</h4>
                            <div id="impact-summary" style="font-size: 0.9em; color: #666;">
                                <!-- Will be filled dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 3: Regional Configuration -->
        <div class="tab-content" id="tab-2">
            <div class="section">
                <h2>⚙️ Regional Configuration</h2>
                <p style="color: #666; margin-bottom: 30px;">
                    Create custom regional models by uploading data or entering values manually. Your custom regions will be saved locally and appear in the country selector.
                </p>

                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 30px;">
                    <!-- CSV Upload Section -->
                    <div class="card" style="background: #f8f9fa;">
                        <h3>📁 Upload CSV Data</h3>
                        <p style="margin-bottom: 20px;">Upload a CSV file with your regional data following the format below:</p>

                        <div style="background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-family: monospace; font-size: 0.85em; overflow-x: auto;">
                            <strong>Required CSV Format:</strong><br>
                            region_name,school,disease,injury,fertility,obesity,literacy,gdp,life<br>
                            "My Region",95,45,8.5,3.2,12.5,0.95,4.5,68
                        </div>

                        <div style="background: #fff3cd; padding: 12px; border-radius: 6px; margin-bottom: 20px; font-size: 0.9em;">
                            <strong>📋 Field Descriptions:</strong><br>
                            • <strong>region_name</strong>: Name of your region<br>
                            • <strong>school</strong>: Primary enrollment, female (30-130%)<br>
                            • <strong>disease</strong>: Communicable diseases rate (10-80%)<br>
                            • <strong>injury</strong>: Death by injury, female (1-20%)<br>
                            • <strong>fertility</strong>: Fertility rate (1-7 births/woman)<br>
                            • <strong>obesity</strong>: Female obesity prevalence (1-40%)<br>
                            • <strong>literacy</strong>: Youth literacy GPI (0.5-1.2)<br>
                            • <strong>gdp</strong>: GDP growth trend (-20 to +15%)<br>
                            • <strong>life</strong>: Life expectancy female (50-85 years)
                        </div>

                        <input type="file" id="csv-upload" accept=".csv" style="display: none;" onchange="handleCSVUpload(event)">
                        <button class="btn" onclick="document.getElementById('csv-upload').click()" style="width: 100%; margin-bottom: 10px;">
                            📤 Choose CSV File
                        </button>
                        <a href="example_region.csv" download class="btn" style="width: 100%; text-align: center; display: block; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); margin-bottom: 10px; text-decoration: none;">
                            📥 Download Example CSV
                        </a>
                        <div id="csv-status" style="margin-top: 10px; padding: 10px; border-radius: 6px; display: none;"></div>
                    </div>

                    <!-- Manual Entry Section -->
                    <div class="card" style="background: #f8f9fa;">
                        <h3>✍️ Manual Data Entry</h3>
                        <p style="margin-bottom: 20px;">Enter your regional data manually:</p>

                        <div style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">Region Name *</label>
                                <input type="text" id="manual-region-name" placeholder="e.g., My Custom Region"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    📚 Primary Enrollment, Female (%) *
                                </label>
                                <input type="number" id="manual-school" min="30" max="130" step="1" value="95"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    ⚕️ Communicable Diseases Rate (%) *
                                </label>
                                <input type="number" id="manual-disease" min="10" max="80" step="1" value="45"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    🤕 Death by Injury, Female (%) *
                                </label>
                                <input type="number" id="manual-injury" min="1" max="20" step="0.5" value="8"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    👶 Fertility Rate (births/woman) *
                                </label>
                                <input type="number" id="manual-fertility" min="1" max="7" step="0.1" value="3.5"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    ⚖️ Female Obesity Prevalence (%) *
                                </label>
                                <input type="number" id="manual-obesity" min="1" max="40" step="0.5" value="12"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    📖 Youth Literacy GPI *
                                </label>
                                <input type="number" id="manual-literacy" min="0.5" max="1.2" step="0.01" value="0.95"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    📈 GDP Growth Trend (%) *
                                </label>
                                <input type="number" id="manual-gdp" min="-20" max="15" step="0.1" value="4.5"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <div class="control-group" style="margin-bottom: 20px;">
                                <label style="font-weight: 600; margin-bottom: 5px; display: block;">
                                    💚 Life Expectancy, Female (years) *
                                </label>
                                <input type="number" id="manual-life" min="50" max="85" step="1" value="68"
                                    style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
                            </div>

                            <button class="btn" onclick="saveManualRegion()" style="width: 100%;">
                                💾 Save Region
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Saved Regions List -->
                <div style="margin-top: 40px;">
                    <h3 style="color: #4facfe; margin-bottom: 20px;">📊 Your Saved Regions</h3>
                    <div id="saved-regions-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: #e9ecef; padding: 30px; border-radius: 10px; text-align: center; color: #666;">
                            <p style="font-size: 1.1em;">No custom regions saved yet.</p>
                            <p style="font-size: 0.9em; margin-top: 10px;">Upload a CSV or enter data manually to create your first region.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>🎓 Gender and Economic Development Analysis System</p>
            <p>Generated with advanced machine learning and statistical techniques</p>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(index) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach((content, i) => {
                content.classList.toggle('active', i === index);
            });
        }

        // Policy projection model coefficients (based on correlation analysis)
        const modelCoefficients = {
            schoolEnrollment: -0.489,
            diseaseRate: 0.469,
            injuryRate: -0.459,
            fertilityRate: -0.417,
            obesityRate: 0.409,
            literacyParity: -0.383
        };

        // Default values
        const defaultValues = {
            schoolEnrollment: 85,
            diseaseRate: 45,
            injuryRate: 8,
            fertilityRate: 3.5,
            obesityRate: 12,
            literacyParity: 0.95
        };

        // Update slider values display
        document.getElementById('school-enrollment').addEventListener('input', function() {
            document.getElementById('school-val').textContent = this.value;
            calculateProjection();
        });

        document.getElementById('disease-rate').addEventListener('input', function() {
            document.getElementById('disease-val').textContent = this.value;
            calculateProjection();
        });

        document.getElementById('injury-rate').addEventListener('input', function() {
            document.getElementById('injury-val').textContent = this.value;
            calculateProjection();
        });

        document.getElementById('fertility-rate').addEventListener('input', function() {
            document.getElementById('fertility-val').textContent = this.value;
            calculateProjection();
        });

        document.getElementById('obesity-rate').addEventListener('input', function() {
            document.getElementById('obesity-val').textContent = this.value;
            calculateProjection();
        });

        document.getElementById('literacy-parity').addEventListener('input', function() {
            document.getElementById('literacy-val').textContent = this.value;
            calculateProjection();
        });

        function calculateProjection() {
            const values = {
                schoolEnrollment: parseFloat(document.getElementById('school-enrollment').value),
                diseaseRate: parseFloat(document.getElementById('disease-rate').value),
                injuryRate: parseFloat(document.getElementById('injury-rate').value),
                fertilityRate: parseFloat(document.getElementById('fertility-rate').value),
                obesityRate: parseFloat(document.getElementById('obesity-rate').value),
                literacyParity: parseFloat(document.getElementById('literacy-parity').value)
            };

            // Normalize values (0-100 scale)
            const normalizedSchool = (values.schoolEnrollment - 30) / 100;
            const normalizedDisease = (values.diseaseRate - 10) / 70;
            const normalizedInjury = (values.injuryRate - 1) / 19;
            const normalizedFertility = (values.fertilityRate - 1) / 6;
            const normalizedObesity = (values.obesityRate - 1) / 39;
            const normalizedLiteracy = (values.literacyParity - 0.5) / 0.7;

            // Calculate weighted impact
            let gdpImpact = 0;
            gdpImpact += normalizedSchool * modelCoefficients.schoolEnrollment * 20;
            gdpImpact += normalizedDisease * modelCoefficients.diseaseRate * 20;
            gdpImpact += normalizedInjury * modelCoefficients.injuryRate * 20;
            gdpImpact += normalizedFertility * modelCoefficients.fertilityRate * 20;
            gdpImpact += normalizedObesity * modelCoefficients.obesityRate * 20;
            gdpImpact += normalizedLiteracy * modelCoefficients.literacyParity * 20;

            // Display results
            const gdpProjection = gdpImpact.toFixed(2);
            document.getElementById('gdp-projection').textContent = (gdpImpact >= 0 ? '+' : '') + gdpProjection + '%';

            // Update impact indicator
            const impactLabel = document.getElementById('impact-label');
            if (gdpImpact > 1) {
                impactLabel.className = 'impact-indicator impact-positive';
                impactLabel.textContent = 'Positive Impact';
            } else if (gdpImpact < -1) {
                impactLabel.className = 'impact-indicator impact-negative';
                impactLabel.textContent = 'Negative Impact';
            } else {
                impactLabel.className = 'impact-indicator impact-neutral';
                impactLabel.textContent = 'Neutral Impact';
            }

            // Generate recommendations
            generateRecommendations(values, gdpImpact);

            // Generate impact summary
            generateImpactSummary(values);
        }

        // Policy tags with descriptions
        const policyTags = {
            "education_girls": "🎓 Eliminate fees, provide scholarships, safe transport, uniforms, and re-entry programs for mothers",
            "tvet_women": "🔧 Technical/STEAM training for women with pathways to employment",
            "srh_access": "💊 Modern contraception, comprehensive sexuality education, youth-friendly clinics",
            "child_marriage_law": "👰 Minimum age 18, civil registration, enforcement and campaigns",
            "maternal_newborn": "🤰 Prenatal care, skilled birth attendance, emergency obstetric care",
            "nutrition_women": "🥗 Iron/folic acid, fortification, nutritional counseling",
            "nutrition_early_child": "🍼 Breastfeeding, complementary feeding programs, malnutrition treatment, water and sanitation",
            "ncd_prevention": "🏃 Sugar-sweetened beverage tax, labeling, school physical activity, screenings",
            "alcohol_policy": "🚫 Taxes, marketing/sales restrictions, addiction treatment",
            "road_safety": "🛣️ Helmets/seatbelts, speed/alcohol control, safe infrastructure",
            "injury_prevention": "🏥 Home/school/workplace safety, violence prevention",
            "mental_health": "🧠 Suicide prevention, helplines, primary care with gender focus",
            "hiv_programs": "💉 PrEP, testing, treatment, sexual violence prevention",
            "care_infrastructure": "👶 Childcare 0-3, extended day, day centers; equal parental leave",
            "almp_women": "💼 Job placement, employment subsidies, mentoring, flexible schedules",
            "formalization_equalpay": "⚖️ Labor inspection, equal pay for equal work",
            "entrepreneurship_women": "💡 Credit, guarantees, public procurement, incubation",
            "business_simplification": "📋 Reduce procedures, one-stop shop, digitalization",
            "legal_reform_WBL": "📜 Inheritance, property, mobility, work, marriage (WBL) reforms",
            "leadership_quotas": "👩‍💼 Quotas/parity, leadership training for women, political violence prevention",
            "gender_budgeting": "💰 Gender-responsive budgeting and expenditure tracking",
            "rural_services": "🚜 Mobile health, rural schools and roads, digital connectivity",
            "urban_safety": "🌃 Lighting, safe transport, urban SRH services",
            "teacher_female_recruit": "👩‍🏫 Target 45-55% female teachers, incentives for remote areas"
        };

        function generateRecommendations(values, gdpImpact) {
            const recommendations = new Set();
            const percentiles = { low: 0.25, mid: 0.50, high: 0.75 };

            // Calculate thresholds (simplified - using absolute values)
            const thresholds = {
                schoolLow: 85,
                schoolHigh: 110,
                diseaseLow: 30,
                diseaseHigh: 55,
                injuryLow: 6,
                injuryHigh: 11,
                fertilityLow: 2.5,
                fertilityHigh: 4.5,
                obesityLow: 10,
                obesityHigh: 25,
                literacyLow: 0.90,
                literacyHigh: 1.02
            };

            // EDUCATION policies
            if (values.schoolEnrollment < thresholds.schoolLow) {
                recommendations.add("education_girls");
                recommendations.add("care_infrastructure");
            }
            if (values.literacyParity < thresholds.literacyLow) {
                recommendations.add("education_girls");
                recommendations.add("tvet_women");
                recommendations.add("teacher_female_recruit");
            }

            // HEALTH - Communicable diseases
            if (values.diseaseRate > thresholds.diseaseHigh) {
                recommendations.add("nutrition_early_child");
                recommendations.add("maternal_newborn");
                recommendations.add("rural_services");
            }

            // HEALTH - Injuries
            if (values.injuryRate > thresholds.injuryHigh) {
                recommendations.add("injury_prevention");
                recommendations.add("road_safety");
            }

            // HEALTH - NCDs (obesity)
            if (values.obesityRate > thresholds.obesityHigh) {
                recommendations.add("ncd_prevention");
            }
            if (values.obesityRate < thresholds.obesityLow) {
                recommendations.add("nutrition_women");
                recommendations.add("nutrition_early_child");
            }

            // FERTILITY & SRH
            if (values.fertilityRate > thresholds.fertilityHigh) {
                recommendations.add("srh_access");
                recommendations.add("education_girls");
                recommendations.add("child_marriage_law");
                recommendations.add("care_infrastructure");
            }
            if (values.fertilityRate < thresholds.fertilityLow) {
                recommendations.add("care_infrastructure");
                recommendations.add("formalization_equalpay");
            }

            // LABOR & ECONOMIC policies (based on GDP impact)
            if (gdpImpact < -1) {
                recommendations.add("almp_women");
                recommendations.add("entrepreneurship_women");
                recommendations.add("business_simplification");
                recommendations.add("care_infrastructure");
            }
            if (gdpImpact > 2) {
                recommendations.add("gender_budgeting");
                recommendations.add("legal_reform_WBL");
            }

            // Cross-cutting governance
            if (values.schoolEnrollment < thresholds.schoolLow || values.literacyParity < thresholds.literacyLow) {
                recommendations.add("legal_reform_WBL");
                recommendations.add("leadership_quotas");
            }

            // Convert to array and format
            const recArray = Array.from(recommendations);

            if (recArray.length === 0) {
                document.getElementById('recommendations').innerHTML =
                    '<p style="color: #28a745;">✅ <strong>Maintain current policies:</strong> Indicators suggest strong development trajectory. Continue monitoring and scaling successful interventions.</p>';
                return;
            }

            // Group by category
            const grouped = {
                'Education & Skills': [],
                'Health & Nutrition': [],
                'Economic Empowerment': [],
                'Governance & Rights': []
            };

            recArray.forEach(tag => {
                const policy = policyTags[tag];
                if (tag.includes('education') || tag.includes('tvet') || tag.includes('teacher') || tag.includes('literacy')) {
                    grouped['Education & Skills'].push(policy);
                } else if (tag.includes('health') || tag.includes('nutrition') || tag.includes('maternal') || tag.includes('srh') ||
                          tag.includes('ncd') || tag.includes('injury') || tag.includes('road') || tag.includes('alcohol') ||
                          tag.includes('mental') || tag.includes('hiv')) {
                    grouped['Health & Nutrition'].push(policy);
                } else if (tag.includes('almp') || tag.includes('entrepreneurship') || tag.includes('business') ||
                          tag.includes('formalization') || tag.includes('care')) {
                    grouped['Economic Empowerment'].push(policy);
                } else {
                    grouped['Governance & Rights'].push(policy);
                }
            });

            let html = '';
            Object.keys(grouped).forEach(category => {
                if (grouped[category].length > 0) {
                    html += `<h5 style="color: #4facfe; margin-top: 15px; margin-bottom: 8px; font-size: 0.95em;">${category}</h5>`;
                    grouped[category].forEach(policy => {
                        html += `<p style="margin-bottom: 10px; padding-left: 10px; border-left: 3px solid #4facfe; font-size: 0.9em; line-height: 1.5;">${policy}</p>`;
                    });
                }
            });

            document.getElementById('recommendations').innerHTML = html;
        }

        function generateImpactSummary(values) {
            const impacts = [];

            const schoolDiff = values.schoolEnrollment - defaultValues.schoolEnrollment;
            if (Math.abs(schoolDiff) > 5) {
                impacts.push(`School Enrollment: ${schoolDiff > 0 ? '▲' : '▼'} ${Math.abs(schoolDiff).toFixed(1)}%`);
            }

            const diseaseDiff = values.diseaseRate - defaultValues.diseaseRate;
            if (Math.abs(diseaseDiff) > 5) {
                impacts.push(`Disease Rate: ${diseaseDiff > 0 ? '▲' : '▼'} ${Math.abs(diseaseDiff).toFixed(1)}%`);
            }

            const fertilityDiff = values.fertilityRate - defaultValues.fertilityRate;
            if (Math.abs(fertilityDiff) > 0.3) {
                impacts.push(`Fertility Rate: ${fertilityDiff > 0 ? '▲' : '▼'} ${Math.abs(fertilityDiff).toFixed(1)} births/woman`);
            }

            if (impacts.length === 0) {
                document.getElementById('impact-summary').innerHTML = '<p>No significant changes from baseline values.</p>';
            } else {
                document.getElementById('impact-summary').innerHTML = impacts.map(i =>
                    `<p style="margin-bottom: 8px;">• ${i}</p>`
                ).join('');
            }
        }

        function resetValues() {
            document.getElementById('school-enrollment').value = defaultValues.schoolEnrollment;
            document.getElementById('school-val').textContent = defaultValues.schoolEnrollment;

            document.getElementById('disease-rate').value = defaultValues.diseaseRate;
            document.getElementById('disease-val').textContent = defaultValues.diseaseRate;

            document.getElementById('injury-rate').value = defaultValues.injuryRate;
            document.getElementById('injury-val').textContent = defaultValues.injuryRate;

            document.getElementById('fertility-rate').value = defaultValues.fertilityRate;
            document.getElementById('fertility-val').textContent = defaultValues.fertilityRate;

            document.getElementById('obesity-rate').value = defaultValues.obesityRate;
            document.getElementById('obesity-val').textContent = defaultValues.obesityRate;

            document.getElementById('literacy-parity').value = defaultValues.literacyParity;
            document.getElementById('literacy-val').textContent = defaultValues.literacyParity;

            calculateProjection();
        }

        // Sub-indicator coefficients
        const subIndicatorCoefficients = {
            school: {
                'primary-gross': -0.489,
                'primary-net': -0.316,
                'primary-gpi': -0.350,
                'adjusted-net': -0.272,
                'primary-completion': -0.237
            },
            disease: {
                'ages-15-59': 0.470,
                'ages-60plus': 0.445,
                'all-female': 0.306,
                'ages-5-14': 0.223,
                'total-population': 0.241
            },
            injury: {
                'ages-15-59': -0.460,
                'all-ages': -0.385,
                'ages-5-14': -0.351,
                'ages-0-4': -0.241
            },
            fertility: {
                'total': -0.418,
                'under5-mortality': 0.262,
                'maternal-mortality': 0.230,
                'maternal-death-risk': 0.323
            },
            obesity: {
                'obesity-adult': 0.414,
                'overweight-adult': 0.199,
                'overweight-under5': 0.239
            },
            literacy: {
                'youth-gpi': -0.383,
                'youth-female-rate': -0.251,
                'youth-illiterate': -0.254,
                'secondary-gpi': -0.279,
                'secondary-female': -0.290
            }
        };

        function updateSubIndicator(category) {
            const subIndicator = document.getElementById(category + '-subindicator').value;
            const coefficient = subIndicatorCoefficients[category][subIndicator];

            // Update the model coefficient for this category
            if (category === 'school') modelCoefficients.schoolEnrollment = coefficient;
            if (category === 'disease') modelCoefficients.diseaseRate = coefficient;
            if (category === 'injury') modelCoefficients.injuryRate = coefficient;
            if (category === 'fertility') modelCoefficients.fertilityRate = coefficient;
            if (category === 'obesity') modelCoefficients.obesityRate = coefficient;
            if (category === 'literacy') modelCoefficients.literacyParity = coefficient;

            calculateProjection();
        }

        function loadCountryData() {
            const country = document.getElementById('country-select').value;

            // Extended country data
            const countryData = {
                'Afghanistan': { school: 68, disease: 72, injury: 14, fertility: 4.5, obesity: 7.2, literacy: 0.52, gdp: -2.1, life: 64 },
                'Angola': { school: 95, disease: 58, injury: 10.5, fertility: 5.3, obesity: 12.5, literacy: 0.88, gdp: 1.2, life: 63 },
                'Bangladesh': { school: 108, disease: 42, injury: 7.8, fertility: 2.1, obesity: 4.2, literacy: 1.02, gdp: 6.8, life: 73 },
                'Benin': { school: 118, disease: 51, injury: 9.2, fertility: 4.8, obesity: 10.4, literacy: 0.75, gdp: 5.5, life: 62 },
                'Bhutan': { school: 102, disease: 34, injury: 6.8, fertility: 2.0, obesity: 7.8, literacy: 0.98, gdp: 4.2, life: 72 },
                'Bolivia': { school: 96, disease: 35, injury: 7.2, fertility: 2.7, obesity: 25.8, literacy: 0.99, gdp: 2.8, life: 74 },
                'Burkina Faso': { school: 85, disease: 65, injury: 11.5, fertility: 5.2, obesity: 8.1, literacy: 0.68, gdp: 5.2, life: 60 },
                'Burundi': { school: 112, disease: 59, injury: 10.8, fertility: 5.4, obesity: 6.5, literacy: 0.91, gdp: 1.8, life: 62 },
                'Cambodia': { school: 110, disease: 38, injury: 7.5, fertility: 2.5, obesity: 6.9, literacy: 0.95, gdp: 7.0, life: 70 },
                'Cameroon': { school: 98, disease: 63, injury: 11.2, fertility: 4.5, obesity: 14.2, literacy: 0.87, gdp: 3.6, life: 60 },
                'Central African Republic': { school: 72, disease: 71, injury: 15.2, fertility: 5.8, obesity: 9.3, literacy: 0.62, gdp: -1.5, life: 53 },
                'Chad': { school: 78, disease: 68, injury: 13.8, fertility: 5.9, obesity: 8.7, literacy: 0.55, gdp: 2.8, life: 54 },
                'Comoros': { school: 104, disease: 45, injury: 8.5, fertility: 4.2, obesity: 11.2, literacy: 0.88, gdp: 2.1, life: 65 },
                'Congo, Dem. Rep.': { school: 89, disease: 67, injury: 12.5, fertility: 6.0, obesity: 9.8, literacy: 0.72, gdp: 1.5, life: 61 },
                'Congo, Rep.': { school: 101, disease: 54, injury: 10.2, fertility: 4.4, obesity: 13.5, literacy: 0.93, gdp: 3.2, life: 65 },
                'Egypt, Arab Rep.': { school: 104, disease: 28, injury: 5.5, fertility: 3.3, obesity: 38.2, literacy: 0.96, gdp: 5.6, life: 73 },
                'Eritrea': { school: 55, disease: 52, injury: 9.8, fertility: 4.1, obesity: 7.5, literacy: 0.83, gdp: 2.9, life: 67 },
                'Eswatini': { school: 98, disease: 72, injury: 11.8, fertility: 3.0, obesity: 28.5, literacy: 0.98, gdp: 1.2, life: 58 },
                'Ethiopia': { school: 95, disease: 55, injury: 9.2, fertility: 4.3, obesity: 6.5, literacy: 0.89, gdp: 9.5, life: 67 },
                'Gambia, The': { school: 95, disease: 47, injury: 9.0, fertility: 5.2, obesity: 13.8, literacy: 0.96, gdp: 5.6, life: 63 },
                'Ghana': { school: 108, disease: 48, injury: 8.8, fertility: 3.9, obesity: 15.6, literacy: 0.96, gdp: 6.5, life: 65 },
                'Guinea': { school: 85, disease: 61, injury: 11.0, fertility: 4.7, obesity: 10.2, literacy: 0.75, gdp: 5.2, life: 62 },
                'Guinea-Bissau': { school: 92, disease: 64, injury: 11.5, fertility: 4.5, obesity: 11.8, literacy: 0.78, gdp: 4.8, life: 59 },
                'Honduras': { school: 102, disease: 32, injury: 8.2, fertility: 2.5, obesity: 28.2, literacy: 0.99, gdp: 3.8, life: 76 },
                'India': { school: 112, disease: 38, injury: 6.5, fertility: 2.2, obesity: 5.8, literacy: 0.98, gdp: 6.8, life: 71 },
                'Jordan': { school: 97, disease: 22, injury: 5.2, fertility: 2.8, obesity: 40.5, literacy: 0.98, gdp: 2.3, life: 76 },
                'Kenya': { school: 104, disease: 48, injury: 8.5, fertility: 3.5, obesity: 8.8, literacy: 0.96, gdp: 5.4, life: 67 },
                'Kyrgyz Republic': { school: 105, disease: 35, injury: 7.2, fertility: 3.2, obesity: 18.5, literacy: 0.99, gdp: 3.8, life: 74 },
                'Lao PDR': { school: 108, disease: 42, injury: 7.8, fertility: 2.7, obesity: 7.5, literacy: 0.93, gdp: 7.0, life: 69 },
                'Lesotho': { school: 102, disease: 68, injury: 10.8, fertility: 3.2, obesity: 22.5, literacy: 0.92, gdp: 2.8, life: 54 },
                'Liberia': { school: 96, disease: 58, injury: 10.5, fertility: 4.4, obesity: 11.2, literacy: 0.82, gdp: 1.2, life: 65 },
                'Madagascar': { school: 125, disease: 52, injury: 9.5, fertility: 4.1, obesity: 8.5, literacy: 0.99, gdp: 4.8, life: 67 },
                'Malawi': { school: 119, disease: 62, injury: 10.8, fertility: 4.2, obesity: 7.8, literacy: 0.91, gdp: 3.5, life: 64 },
                'Mali': { school: 75, disease: 66, injury: 12.2, fertility: 5.9, obesity: 10.8, literacy: 0.72, gdp: 4.2, life: 60 },
                'Mauritania': { school: 98, disease: 48, injury: 9.2, fertility: 4.6, obesity: 16.5, literacy: 0.93, gdp: 3.6, life: 65 },
                'Morocco': { school: 115, disease: 26, injury: 5.8, fertility: 2.4, obesity: 28.5, literacy: 0.95, gdp: 3.5, life: 77 },
                'Mozambique': { school: 110, disease: 64, injury: 11.0, fertility: 4.9, obesity: 9.2, literacy: 0.87, gdp: 3.2, life: 61 },
                'Myanmar': { school: 98, disease: 48, injury: 8.5, fertility: 2.2, obesity: 8.2, literacy: 0.98, gdp: 6.8, life: 68 },
                'Nepal': { school: 121, disease: 38, injury: 7.2, fertility: 2.0, obesity: 6.2, literacy: 0.99, gdp: 6.7, life: 71 },
                'Nicaragua': { school: 110, disease: 28, injury: 6.8, fertility: 2.4, obesity: 32.8, literacy: 0.99, gdp: 4.6, life: 76 },
                'Niger': { school: 68, disease: 69, injury: 12.8, fertility: 6.9, obesity: 8.8, literacy: 0.68, gdp: 5.9, life: 63 },
                'Nigeria': { school: 82, disease: 68, injury: 12, fertility: 5.4, obesity: 9.2, literacy: 0.87, gdp: 2.2, life: 55 },
                'Pakistan': { school: 88, disease: 42, injury: 7.8, fertility: 3.6, obesity: 9.8, literacy: 0.82, gdp: 5.4, life: 68 },
                'Papua New Guinea': { school: 92, disease: 52, injury: 9.5, fertility: 3.6, obesity: 28.8, literacy: 0.88, gdp: 4.5, life: 65 },
                'Philippines': { school: 109, disease: 38, injury: 6.8, fertility: 2.6, obesity: 8.5, literacy: 0.99, gdp: 6.7, life: 72 },
                'Rwanda': { school: 121, disease: 45, injury: 8.2, fertility: 4.0, obesity: 8.2, literacy: 0.98, gdp: 9.4, life: 69 },
                'Samoa': { school: 105, disease: 42, injury: 7.5, fertility: 3.9, obesity: 58.5, literacy: 0.99, gdp: 3.2, life: 74 },
                'Senegal': { school: 88, disease: 51, injury: 9.5, fertility: 4.7, obesity: 12.8, literacy: 0.87, gdp: 6.5, life: 68 },
                'Sierra Leone': { school: 119, disease: 68, injury: 12.2, fertility: 4.3, obesity: 11.5, literacy: 0.89, gdp: 5.1, life: 55 },
                'Sri Lanka': { school: 100, disease: 24, injury: 5.8, fertility: 2.2, obesity: 8.8, literacy: 0.98, gdp: 3.3, life: 78 },
                'Sudan': { school: 75, disease: 54, injury: 10.5, fertility: 4.32, obesity: 11.2, literacy: 0.82, gdp: -13.5, life: 70 },
                'Syrian Arab Republic': { school: 82, disease: 22, injury: 12.8, fertility: 2.8, obesity: 34.2, literacy: 0.98, gdp: -15.2, life: 73 },
                'Tajikistan': { school: 98, disease: 38, injury: 7.2, fertility: 3.6, obesity: 16.8, literacy: 0.99, gdp: 7.4, life: 71 },
                'Tanzania': { school: 89, disease: 55, injury: 10.0, fertility: 4.9, obesity: 9.5, literacy: 0.98, gdp: 6.8, life: 66 },
                'Timor-Leste': { school: 98, disease: 42, injury: 8.2, fertility: 4.1, obesity: 5.8, literacy: 0.95, gdp: 1.8, life: 70 },
                'Togo': { school: 115, disease: 55, injury: 10.2, fertility: 4.4, obesity: 11.8, literacy: 0.89, gdp: 5.3, life: 62 },
                'Tunisia': { school: 110, disease: 18, injury: 4.5, fertility: 2.2, obesity: 32.8, literacy: 0.97, gdp: 2.5, life: 78 },
                'Uganda': { school: 102, disease: 58, injury: 10.5, fertility: 5.0, obesity: 8.2, literacy: 0.93, gdp: 6.5, life: 64 },
                'Uzbekistan': { school: 98, disease: 32, injury: 6.5, fertility: 2.4, obesity: 22.5, literacy: 0.99, gdp: 5.7, life: 72 },
                'Vanuatu': { school: 105, disease: 42, injury: 8.2, fertility: 3.8, obesity: 38.2, literacy: 0.96, gdp: 3.2, life: 71 },
                'Yemen, Rep.': { school: 85, disease: 48, injury: 11.5, fertility: 3.8, obesity: 22.8, literacy: 0.68, gdp: -15.8, life: 67 },
                'Zambia': { school: 106, disease: 64, injury: 11.2, fertility: 4.7, obesity: 10.5, literacy: 0.96, gdp: 3.5, life: 64 },
                'Zimbabwe': { school: 98, disease: 68, injury: 11.8, fertility: 3.6, obesity: 18.5, literacy: 0.95, gdp: 1.2, life: 62 }
            };

            if (country && countryData[country]) {
                const data = countryData[country];

                // Show country info card
                document.getElementById('country-info-card').style.display = 'block';
                document.getElementById('country-name').textContent = country;
                document.getElementById('country-gdp').textContent = (data.gdp >= 0 ? '+' : '') + data.gdp + '%';
                document.getElementById('country-enrollment').textContent = data.school + '%';
                document.getElementById('country-fertility').textContent = data.fertility;
                document.getElementById('country-life').textContent = data.life + ' years';

                // Update sliders
                document.getElementById('school-enrollment').value = data.school;
                document.getElementById('school-val').textContent = data.school;

                document.getElementById('disease-rate').value = data.disease;
                document.getElementById('disease-val').textContent = data.disease;

                document.getElementById('injury-rate').value = data.injury;
                document.getElementById('injury-val').textContent = data.injury;

                document.getElementById('fertility-rate').value = data.fertility;
                document.getElementById('fertility-val').textContent = data.fertility;

                document.getElementById('obesity-rate').value = data.obesity;
                document.getElementById('obesity-val').textContent = data.obesity;

                document.getElementById('literacy-parity').value = data.literacy;
                document.getElementById('literacy-val').textContent = data.literacy;

                calculateProjection();
            } else {
                document.getElementById('country-info-card').style.display = 'none';
                resetValues();
            }
        }

        // ========================================
        // REGIONAL CONFIGURATION FUNCTIONS
        // ========================================

        // Load custom regions from localStorage
        function loadCustomRegions() {
            const regions = localStorage.getItem('customRegions');
            return regions ? JSON.parse(regions) : {};
        }

        // Save custom regions to localStorage
        function saveCustomRegions(regions) {
            localStorage.setItem('customRegions', JSON.stringify(regions));
        }

        // Handle CSV file upload
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                parseCSV(text);
            };
            reader.readAsText(file);
        }

        // Parse CSV and save regions
        function parseCSV(text) {
            const statusDiv = document.getElementById('csv-status');
            const lines = text.split('\n').filter(line => line.trim());

            if (lines.length < 2) {
                showStatus('Error: CSV file must contain at least a header and one data row', 'error');
                return;
            }

            const header = lines[0].split(',').map(h => h.trim().replace(/['"]/g, ''));
            const expectedHeaders = ['region_name', 'school', 'disease', 'injury', 'fertility', 'obesity', 'literacy', 'gdp', 'life'];

            // Validate headers
            const hasAllHeaders = expectedHeaders.every(h => header.includes(h));
            if (!hasAllHeaders) {
                showStatus('Error: CSV must have columns: ' + expectedHeaders.join(', '), 'error');
                return;
            }

            const customRegions = loadCustomRegions();
            let savedCount = 0;
            let errors = [];

            // Parse data rows
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/['"]/g, ''));
                const row = {};

                header.forEach((col, idx) => {
                    row[col] = values[idx];
                });

                // Validate required fields
                if (!row.region_name) {
                    errors.push(`Row ${i}: Missing region name`);
                    continue;
                }

                // Parse numeric values
                const regionData = {
                    school: parseFloat(row.school),
                    disease: parseFloat(row.disease),
                    injury: parseFloat(row.injury),
                    fertility: parseFloat(row.fertility),
                    obesity: parseFloat(row.obesity),
                    literacy: parseFloat(row.literacy),
                    gdp: parseFloat(row.gdp),
                    life: parseFloat(row.life)
                };

                // Validate ranges
                if (regionData.school < 30 || regionData.school > 130) {
                    errors.push(`Row ${i}: School enrollment must be between 30-130%`);
                    continue;
                }
                if (regionData.disease < 10 || regionData.disease > 80) {
                    errors.push(`Row ${i}: Disease rate must be between 10-80%`);
                    continue;
                }
                if (regionData.fertility < 1 || regionData.fertility > 7) {
                    errors.push(`Row ${i}: Fertility rate must be between 1-7`);
                    continue;
                }

                // Save region
                customRegions[row.region_name] = regionData;
                savedCount++;
            }

            saveCustomRegions(customRegions);
            updateCountrySelector();
            displaySavedRegions();

            if (errors.length > 0) {
                showStatus(`Saved ${savedCount} region(s). Errors: ${errors.join('; ')}`, 'warning');
            } else {
                showStatus(`Successfully saved ${savedCount} region(s) from CSV!`, 'success');
            }

            // Clear file input
            document.getElementById('csv-upload').value = '';
        }

        // Save manual region
        function saveManualRegion() {
            const regionName = document.getElementById('manual-region-name').value.trim();

            if (!regionName) {
                showStatus('Please enter a region name', 'error');
                return;
            }

            const regionData = {
                school: parseFloat(document.getElementById('manual-school').value),
                disease: parseFloat(document.getElementById('manual-disease').value),
                injury: parseFloat(document.getElementById('manual-injury').value),
                fertility: parseFloat(document.getElementById('manual-fertility').value),
                obesity: parseFloat(document.getElementById('manual-obesity').value),
                literacy: parseFloat(document.getElementById('manual-literacy').value),
                gdp: parseFloat(document.getElementById('manual-gdp').value),
                life: parseFloat(document.getElementById('manual-life').value)
            };

            // Validate data
            if (Object.values(regionData).some(v => isNaN(v))) {
                showStatus('Please fill in all numeric fields with valid numbers', 'error');
                return;
            }

            const customRegions = loadCustomRegions();
            customRegions[regionName] = regionData;
            saveCustomRegions(customRegions);

            updateCountrySelector();
            displaySavedRegions();

            showStatus(`Region "${regionName}" saved successfully!`, 'success');

            // Clear form
            document.getElementById('manual-region-name').value = '';
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('csv-status');
            statusDiv.style.display = 'block';
            statusDiv.textContent = message;

            if (type === 'success') {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
            } else if (type === 'warning') {
                statusDiv.style.background = '#fff3cd';
                statusDiv.style.color = '#856404';
                statusDiv.style.border = '1px solid #ffeeba';
            }

            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Update country selector with custom regions
        function updateCountrySelector() {
            const selector = document.getElementById('country-select');
            const customRegions = loadCustomRegions();

            // Remove existing custom options (those not in countryData)
            const options = Array.from(selector.options);
            options.forEach(option => {
                if (option.value && !countryData[option.value] && option.value !== '') {
                    selector.removeChild(option);
                }
            });

            // Add custom regions
            Object.keys(customRegions).forEach(regionName => {
                if (!Array.from(selector.options).some(opt => opt.value === regionName)) {
                    const option = document.createElement('option');
                    option.value = regionName;
                    option.textContent = regionName + ' 🌍';
                    selector.appendChild(option);
                }
            });

            // Merge custom regions into countryData for loadCountryData function
            Object.assign(countryData, customRegions);
        }

        // Display saved regions
        function displaySavedRegions() {
            const customRegions = loadCustomRegions();
            const container = document.getElementById('saved-regions-list');

            if (Object.keys(customRegions).length === 0) {
                container.innerHTML = `
                    <div style="background: #e9ecef; padding: 30px; border-radius: 10px; text-align: center; color: #666;">
                        <p style="font-size: 1.1em;">No custom regions saved yet.</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Upload a CSV or enter data manually to create your first region.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = Object.entries(customRegions).map(([name, data]) => `
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; position: relative;">
                    <button onclick="deleteRegion('${name}')"
                        style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 1.2em; display: flex; align-items: center; justify-content: center;"
                        title="Delete region">×</button>
                    <h4 style="margin-top: 0; margin-bottom: 15px; font-size: 1.3em;">🌍 ${name}</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9em;">
                        <div><strong>School:</strong> ${data.school}%</div>
                        <div><strong>Disease:</strong> ${data.disease}%</div>
                        <div><strong>Injury:</strong> ${data.injury}%</div>
                        <div><strong>Fertility:</strong> ${data.fertility}</div>
                        <div><strong>Obesity:</strong> ${data.obesity}%</div>
                        <div><strong>Literacy:</strong> ${data.literacy}</div>
                        <div><strong>GDP:</strong> ${data.gdp >= 0 ? '+' : ''}${data.gdp}%</div>
                        <div><strong>Life Exp:</strong> ${data.life} yrs</div>
                    </div>
                </div>
            `).join('');
        }

        // Delete a region
        function deleteRegion(regionName) {
            if (!confirm(`Are you sure you want to delete "${regionName}"?`)) {
                return;
            }

            const customRegions = loadCustomRegions();
            delete customRegions[regionName];
            saveCustomRegions(customRegions);

            // Remove from countryData
            delete countryData[regionName];

            updateCountrySelector();
            displaySavedRegions();

            showStatus(`Region "${regionName}" deleted successfully`, 'success');
        }

        // Initialize on load
        window.addEventListener('load', function() {
            calculateProjection();
            updateCountrySelector();
            displaySavedRegions();
        });
    </script>
</body>
</html>
